import{jsx as o,jsxs as _}from"https://esm.sh/react@18.2.0/jsx-runtime";import{createElement as j,useState as s,useEffect as m}from"https://esm.sh/react@18.2.0";import{createRoot as N}from"https://esm.sh/react-dom@18.2.0/client";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const t of n.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&u(t)}).observe(document,{childList:!0,subtree:!0});function f(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(e){if(e.ep)return;e.ep=!0;const n=f(e);fetch(e.href,n)}})();function O(){const[l,a]=s(),[f,u]=s(30),[e,n]=s({enable:!0,position:"top"}),[t,p]=s(),[h,y]=s(),[I,d]=s(!1);m(()=>{(async()=>{var L,x;var i=await fetch("/api/config",{mode:"no-cors"}),c=await i.json();a(c.service),u(c.interval),((L=c.metainfo)==null?void 0:L.enable)===!1&&n({...e,enable:!1}),(x=c.metainfo)!=null&&x.position&&n({...e,position:c.metainfo.position})})().catch(console.error)},[]);async function g(){return l?await(await fetch(`/api/image/${l}`,{mode:"no-cors"})).json():void 0}function v(){g().then(r=>{r&&(y(r),r.data_url||(new Image().src=r.url))})}m(()=>{t||g().then(r=>{r&&(d(!1),p(r),v())})},[l]),m(()=>{const r=window.setTimeout(()=>{d(!1),p(h),v()},f*1e3);return()=>clearTimeout(r)},[f,h]);async function b(){const r=await g();d(!1),p(h),y(r),r.data_url||(new Image().src=r.url)}async function w(){t!=null&&t.pixiv_id&&(await fetch(`/api/image/pixiv/like?id=${t.pixiv_id}`,{mode:"no-cors"}),d(!0))}if(m(()=>{const r=i=>{(i==null?void 0:i.key)==="l"||(i==null?void 0:i.key)==="L"?(i.preventDefault(),w()):((i==null?void 0:i.key)==="n"||(i==null?void 0:i.key)==="N")&&(i.preventDefault(),b())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)}),!(t!=null&&t.url))return o("div",{children:"Requesting ..."});const k=`url(${t.data_url??t.url})`;return _("div",{children:[o("div",{id:"bg",style:{backgroundImage:k}}),o("div",{id:"fg",style:{backgroundImage:k}}),_("div",{id:"info",className:[e.enable?"":"hide",e.position==="bottom"?"bottom":""].join(" "),children:[o("a",{id:"title",href:t.page_url??"#",target:"_blank",children:t.title??""}),o("br",{}),o("a",{id:"author",href:t.author_url??"#",target:"_blank",children:t.author??""}),o("a",{id:"next",href:"#",onClick:b,children:"➡️"}),o("a",{id:"like",href:"#",onClick:w,children:I?"❤️":"💙"})]})]})}const E=N(document.querySelector("#app"));E.render(j(O));
