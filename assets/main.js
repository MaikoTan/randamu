import{jsx as o,jsxs as I}from"https://esm.sh/react@18.2.0/jsx-runtime";import{createElement as j,useState as s,useEffect as m}from"https://esm.sh/react@18.2.0";import{createRoot as N}from"https://esm.sh/react-dom@18.2.0/client";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function f(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(e){if(e.ep)return;e.ep=!0;const n=f(e);fetch(e.href,n)}})();const p=new URLSearchParams(window.location.search).get("api_root")??"http://localhost:8089/api";function P(){const[l,a]=s(),[f,u]=s(30),[e,n]=s({enable:!0,position:"top"}),[i,h]=s(),[g,v]=s(),[O,d]=s(!1);m(()=>{(async()=>{var _,x;var r=await fetch(p+"/config",{mode:"cors"}),c=await r.json();a(c.service),u(c.interval),((_=c.metainfo)==null?void 0:_.enable)===!1&&n({...e,enable:!1}),(x=c.metainfo)!=null&&x.position&&n({...e,position:c.metainfo.position})})().catch(console.error)},[]);async function y(){return l?await(await fetch(p+`/image/${l}`,{mode:"cors"})).json():void 0}function w(){y().then(t=>{var r;t&&(v(t),t.data_url||(new Image().src=(r=t.url)!=null&&r.startsWith("http")?t.url:p+t.url))})}m(()=>{i||y().then(t=>{t&&(d(!1),h(t),w())})},[l]),m(()=>{const t=window.setTimeout(()=>{d(!1),h(g),w()},f*1e3);return()=>clearTimeout(t)},[f,g]);async function b(){const t=await y();d(!1),h(g),v(t),t.data_url||(new Image().src=t.url)}async function k(){i!=null&&i.pixiv_id&&(await fetch(p+`/image/pixiv/like?id=${i.pixiv_id}`,{mode:"cors"}),d(!0))}if(m(()=>{const t=r=>{(r==null?void 0:r.key)==="l"||(r==null?void 0:r.key)==="L"?(r.preventDefault(),k()):((r==null?void 0:r.key)==="n"||(r==null?void 0:r.key)==="N")&&(r.preventDefault(),b())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)}),!(i!=null&&i.url))return o("div",{children:"Requesting ..."});const L=`url(${i.data_url??i.url})`;return I("div",{children:[o("div",{id:"bg",style:{backgroundImage:L}}),o("div",{id:"fg",style:{backgroundImage:L}}),I("div",{id:"info",className:[e.enable?"":"hide",e.position==="bottom"?"bottom":""].join(" "),children:[o("a",{id:"title",href:i.page_url??"#",target:"_blank",children:i.title??""}),o("br",{}),o("a",{id:"author",href:i.author_url??"#",target:"_blank",children:i.author??""}),o("a",{id:"next",href:"#",onClick:b,children:"â¡ï¸"}),o("a",{id:"like",href:"#",onClick:k,children:O?"â¤ï¸":"ğŸ’™"})]})]})}const E=N(document.querySelector("#app"));E.render(j(P));
