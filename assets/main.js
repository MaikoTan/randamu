import{jsx as i,jsxs as x}from"https://esm.sh/react@18.2.0/jsx-runtime";import{createElement as j,useState as s,useEffect as m}from"https://esm.sh/react@18.2.0";import{createRoot as N}from"https://esm.sh/react-dom@18.2.0/client";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const t of o.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&u(t)}).observe(document,{childList:!0,subtree:!0});function f(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(e){if(e.ep)return;e.ep=!0;const o=f(e);fetch(e.href,o)}})();const I=new URLSearchParams(window.location.search).get("api_root")??"http://localhost:8089/api";function P(){const[l,a]=s(),[f,u]=s(30),[e,o]=s({enable:!0,position:"top"}),[t,p]=s(),[h,y]=s(),[O,d]=s(!1);m(()=>{(async()=>{var L,_;var n=await fetch("/api/config",{mode:"no-cors"}),c=await n.json();a(c.service),u(c.interval),((L=c.metainfo)==null?void 0:L.enable)===!1&&o({...e,enable:!1}),(_=c.metainfo)!=null&&_.position&&o({...e,position:c.metainfo.position})})().catch(console.error)},[]);async function g(){return l?await(await fetch(I+`/image/${l}`,{mode:"no-cors"})).json():void 0}function v(){g().then(r=>{r&&(y(r),r.data_url||(new Image().src=r.url))})}m(()=>{t||g().then(r=>{r&&(d(!1),p(r),v())})},[l]),m(()=>{const r=window.setTimeout(()=>{d(!1),p(h),v()},f*1e3);return()=>clearTimeout(r)},[f,h]);async function w(){const r=await g();d(!1),p(h),y(r),r.data_url||(new Image().src=r.url)}async function b(){t!=null&&t.pixiv_id&&(await fetch(I+`/image/pixiv/like?id=${t.pixiv_id}`,{mode:"no-cors"}),d(!0))}if(m(()=>{const r=n=>{(n==null?void 0:n.key)==="l"||(n==null?void 0:n.key)==="L"?(n.preventDefault(),b()):((n==null?void 0:n.key)==="n"||(n==null?void 0:n.key)==="N")&&(n.preventDefault(),w())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)}),!(t!=null&&t.url))return i("div",{children:"Requesting ..."});const k=`url(${t.data_url??t.url})`;return x("div",{children:[i("div",{id:"bg",style:{backgroundImage:k}}),i("div",{id:"fg",style:{backgroundImage:k}}),x("div",{id:"info",className:[e.enable?"":"hide",e.position==="bottom"?"bottom":""].join(" "),children:[i("a",{id:"title",href:t.page_url??"#",target:"_blank",children:t.title??""}),i("br",{}),i("a",{id:"author",href:t.author_url??"#",target:"_blank",children:t.author??""}),i("a",{id:"next",href:"#",onClick:w,children:"â¡ï¸"}),i("a",{id:"like",href:"#",onClick:b,children:O?"â¤ï¸":"ğŸ’™"})]})]})}const E=N(document.querySelector("#app"));E.render(j(P));
